<!DOCTYPE html>
<html>
<head>
    <title>10åˆ†æ–œç‡çµæ®º V3.7 - çµ‚æ¥µç‰ˆ</title>
    <style>
        body { background: #111; color: #eee; font-family: sans-serif; margin: 20px; font-size: 14px; }
        .dashboard { display: flex; gap: 15px; margin-bottom: 20px; align-items: center; background: #222; padding: 15px; border-radius: 8px; border: 1px solid #444; flex-wrap: wrap; }
        .search-box { padding: 8px; border-radius: 4px; border: 1px solid #555; background: #333; color: white; width: 200px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
        th, td { padding: 10px; border: 1px solid #333; text-align: left; }
        th { background: #2a2a2a; }
        .READY { color: #ffeb3b; font-weight: bold; background: rgba(255, 235, 59, 0.1); }
        .ENTRY { color: #fff; background: #ff0000; font-weight: bold; animation: pulse 0.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        button { padding: 6px 12px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; }
        .btn-del { background: #444; color: #ff4444; }
        .log-container { background: #1a1a1a; border: 1px solid #444; padding: 15px; border-radius: 8px; max-height: 300px; overflow-y: auto; }
        .log-item { border-bottom: 1px solid #333; padding: 5px 0; font-family: monospace; font-size: 12px; }
        #status { margin-left: auto; color: #00ffff; }
    </style>
</head>
<body>

    <div class="dashboard">
        <div style="font-size: 18px; font-weight: bold; color: #ffeb3b;">10åˆ†æ–œç‡çµæ®º V3.7</div>
        <input type="text" id="searchInput" class="search-box" placeholder="ğŸ” æœå°‹æ¨™çš„..." oninput="render()">
        <button style="background: #d32f2f; color: white;" onclick="toggleSystem()" id="startBtn">ğŸš€ å•Ÿå‹•ç›£æ§</button>
        <button style="background: #0088cc; color: white;" onclick="testPush()">ğŸ§ª æ¸¬è©¦ç¾¤çµ„æ¨æ’­</button>
        <div id="status">ç³»çµ±å°±ç·’ (8s/æ¬¡)</div>
    </div>

    <h3 style="color: #00ffff;">ğŸ“ ç•¶å‰çµæ®ºæ¸…å–®</h3>
    <table>
        <thead>
            <tr>
                <th>æ¨™çš„</th>
                <th>ä¸Šæ¦œæ™‚é–“</th>
                <th>ç•¶å‰è³‡è²» (10åˆ†è®Šå‹•)</th>
                <th>10åˆ†å‰</th>
                <th>OI è®Šå‹•%</th>
                <th>ç‹€æ…‹</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody id="radarBody"></tbody>
    </table>

    <h3 style="color: #ffeb3b;">ğŸ“œ çµæ®ºæ—¥èªŒ (æ¨æ’­æ­·å²)</h3>
    <div class="log-container" id="huntLog">
        <div class="log-item">ç³»çµ±ç­‰å¾…å•Ÿå‹•...</div>
    </div>

<script>
    const CONFIG = {
        PO_USER: "Gkhqyhobnxzjfwgvaiyp347m1jkhn4", 
        PO_TOKEN: "acyoe3sz15x4n91r1349fdcau7x6pw", 
        BLACKLIST: ['BTCUSDT', 'ETHUSDT', 'SOLUSDT', 'XRPUSDT', 'BNBUSDT', 'BNXUSDT'],
        MIN_FUND: 0.0005 
    };

    let isRunning = false;
    let historyData = {}; 
    let allData = {};
    let huntLogs = [];

    async function sendPush(title, message) {
        const params = new URLSearchParams();
        params.append("token", CONFIG.PO_TOKEN);
        params.append("user", CONFIG.PO_USER);
        params.append("title", title);
        params.append("message", message);
        params.append("priority", "1");
        params.append("sound", "alien");
        try {
            await fetch('https://api.pushover.net/1/messages.json', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: params.toString()
            });
            addLog(`ğŸš€ æ¨æ’­æˆåŠŸ: ${title}`);
        } catch (e) { console.error("Push Error", e); }
    }

    function addLog(msg) {
        const time = new Date().toLocaleTimeString();
        huntLogs.unshift(`[${time}] ${msg}`);
        if (huntLogs.length > 50) huntLogs.pop();
        const logDiv = document.getElementById('huntLog');
        logDiv.innerHTML = huntLogs.map(l => `<div class="log-item">${l}</div>`).join('');
    }

    function testPush() { sendPush("é€£ç·šæ¸¬è©¦", "çµ‚æ¥µå„€è¡¨æ¿ V3.7 é€£ç·šæ­£å¸¸ï¼"); alert("æ¸¬è©¦ç™¼é€ä¸­..."); }

    function removeSymbol(symbol) {
        delete allData[symbol];
        delete historyData[symbol];
        render();
    }

    async function getOI(symbol) {
        try {
            const res = await fetch(`https://fapi.binance.com/fapi/v1/openInterest?symbol=${symbol}`);
            const data = await res.json();
            return parseFloat(data.openInterest);
        } catch (e) { return null; }
    }

    async function mainLoop() {
        if (!isRunning) return;
        try {
            const res = await fetch('https://fapi.binance.com/fapi/v1/premiumIndex');
            const funds = await res.json();
            const now = Date.now();

            for (const f of funds) {
                const symbol = f.symbol;
                if (!symbol.endsWith('USDT') || CONFIG.BLACKLIST.includes(symbol)) continue;

                const currentFund = parseFloat(f.lastFundingRate);
                
                // åªæœ‰è³‡è²»é”æ¨™æˆ–å·²åœ¨è¡¨ä¸Šçš„æ‰æŠ“ OI
                if (Math.abs(currentFund) < CONFIG.MIN_FUND && !allData[symbol]) continue;

                const currentOI = await getOI(symbol);
                if (currentOI === null) continue;

                if (!historyData[symbol]) {
                    historyData[symbol] = [];
                    allData[symbol] = { firstSeen: new Date().toLocaleTimeString() };
                }
                historyData[symbol].push({ time: now, fund: currentFund, oi: currentOI });
                historyData[symbol] = historyData[symbol].filter(h => now - h.time <= 600000);

                const baseData = historyData[symbol][0];
                const prevFund = baseData.fund;
                const prevOI = baseData.oi;

                const fundChange = prevFund !== 0 ? ((currentFund - prevFund) / Math.abs(prevFund)) * 100 : 0;
                const oiChange = prevOI !== 0 ? ((currentOI - prevOI) / prevOI) * 100 : 0;

                let st = "NORMAL";
                let oldStatus = allData[symbol].st || "NORMAL";

                if (Math.abs(currentFund) >= CONFIG.MIN_FUND) {
                    if (Math.abs(fundChange) >= 30) {
                        st = "READY";
                        if (Math.abs(fundChange) >= 50 && oiChange > 0) {
                            st = "ENTRY";
                            if (oldStatus !== "ENTRY") {
                                sendPush(`ğŸ¯ çµæ®ºä¿¡è™Ÿ: ${symbol}`, `æ–œç‡:${fundChange.toFixed(1)}% | OI:${oiChange.toFixed(2)}%`);
                                addLog(`ğŸ”¥ ENTRYè§¸ç™¼: ${symbol} (æ–œç‡${fundChange.toFixed(1)}%)`);
                            }
                        }
                    }
                }

                allData[symbol] = {
                    ...allData[symbol],
                    symbol,
                    currentFund: (currentFund * 100).toFixed(4),
                    fundChange: fundChange.toFixed(1),
                    prevFund: (prevFund * 100).toFixed(4),
                    oiChange: oiChange.toFixed(2),
                    st
                };
            }
            render();
            document.getElementById('status').innerText = "âœ… 8ç§’æƒæä¸­";
        } catch (e) { console.error(e); }
    }

    function render() {
        const keyword = document.getElementById('searchInput').value.toUpperCase();
        const rows = Object.values(allData).filter(d => d.symbol && d.symbol.includes(keyword));
        
        const sorted = rows.sort((a, b) => {
            if (a.st === "ENTRY" && b.st !== "ENTRY") return -1;
            if (b.st === "ENTRY" && a.st !== "ENTRY") return 1;
            return Math.abs(b.fundChange) - Math.abs(a.fundChange);
        });

        document.getElementById('radarBody').innerHTML = sorted.map(c => `
            <tr>
                <td><b>${c.symbol}</b></td>
                <td>${c.firstSeen}</td>
                <td style="color:${c.currentFund < 0 ? '#ff4444' : '#00ff00'}">${c.currentFund}% (${c.fundChange}%)</td>
                <td>${c.prevFund}%</td>
                <td style="color:${c.oiChange > 0 ? '#00ff00' : '#ff4444'}">${c.oiChange}%</td>
                <td class="${c.st}">${c.st}</td>
                <td><button class="btn-del" onclick="removeSymbol('${c.symbol}')">åˆªé™¤</button></td>
            </tr>
        `).join('');
    }

    function toggleSystem() {
        isRunning = !isRunning;
        document.getElementById('startBtn').innerText = isRunning ? "ğŸ›‘ åœæ­¢" : "ğŸš€ å•Ÿå‹•";
        if (isRunning) { addLog("ç³»çµ±å•Ÿå‹•..."); mainLoop(); setInterval(mainLoop, 8000); }
    }
</script>
</body>
</html>
